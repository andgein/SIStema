{# Based on django/forms/widgets/multiple_input.html #}
{% with id=widget.attrs.id %}
    {% for group, options, index in widget.optgroups %}
        {% if group %}
            <li>{{ group }}<ul{% if id %} id="{{ id }}_{{ index }}"{% endif %}>
        {% endif %}
        {% for option in options %}
            {% include option.template_name with widget=option %}
        {% endfor %}
        {% if group %}
            </ul></li>
        {% endif %}
    {% endfor %}
{% endwith %}
